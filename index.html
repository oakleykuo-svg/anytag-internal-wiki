<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TAIWAN AnyTag & AnyCreator Support Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand-red: #E14F4B;
            --sidebar-bg: #091632; 
            --sidebar-text: #a0a0a0;
            --sidebar-hover: #1c2b4a;
            --sidebar-active: var(--brand-red);
            --main-bg: #f4f4f9;
            --card-bg: #ffffff;
            --text-primary: #222222;
            --text-secondary: #666666;
            --shadow-sm: 0 2px 4px 0 rgb(0 0 0 / 0.05);
            --radius: 12px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--main-bg);
            color: var(--text-primary);
            display: flex;
            height: 100vh;
            overflow: hidden;
            background: 
                linear-gradient(135deg, rgba(9, 22, 50, 0.03) 25%, transparent 25%) -20px 0,
                linear-gradient(225deg, rgba(9, 22, 50, 0.03) 25%, transparent 25%) -20px 0,
                linear-gradient(315deg, rgba(9, 22, 50, 0.03) 25%, transparent 25%),
                linear-gradient(45deg, rgba(9, 22, 50, 0.03) 25%, transparent 25%);
            background-size: 60px 60px;
            background-color: var(--main-bg);
            animation: techFlow 10s linear infinite;
        }

        @keyframes techFlow {
            0% { background-position: 0 0; }
            100% { background-position: 60px 60px; }
        }

        .sidebar { width: 280px; background-color: var(--sidebar-bg); display: flex; flex-direction: column; padding: 24px 16px; flex-shrink: 0; border-right: 1px solid rgba(255,255,255,0.05); z-index: 10; }
        .brand { color: #fff; font-size: 18px; font-weight: 700; display: flex; align-items: center; gap: 10px; margin-bottom: 40px; padding-left: 8px; line-height: 1.4; }
        .brand span { color: var(--brand-red); font-size: 24px; line-height: 0; }
        .nav-group { margin-bottom: 28px; }
        .nav-title { font-size: 11px; text-transform: uppercase; color: #889bb3; font-weight: 700; padding-left: 12px; margin-bottom: 10px; letter-spacing: 1.2px; }
        .nav-item { padding: 12px 14px; color: #bdcbe0; cursor: pointer; border-radius: 8px; font-size: 14px; font-weight: 500; display: flex; align-items: center; gap: 12px; transition: all 0.2s ease; margin-bottom: 6px; border-left: 3px solid transparent; }
        .nav-item:hover { background-color: var(--sidebar-hover); color: #fff; }
        .nav-item.active { background-color: rgba(225, 79, 75, 0.15); color: var(--brand-red); border-left: 3px solid var(--brand-red); }
        .nav-item.active i { color: var(--brand-red); }

        .main { flex: 1; overflow-y: auto; padding: 40px; position: relative; z-index: 5; background: rgba(244, 244, 249, 0.8); }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .page-title h1 { font-size: 32px; font-weight: 800; color: #000; letter-spacing: -0.5px; }
        .page-title p { color: var(--text-secondary); margin-top: 8px; font-size: 15px; }

        .search-box { position: relative; width: 320px; }
        .search-box input { width: 100%; padding: 14px 20px; padding-left: 44px; border-radius: 50px; border: 2px solid transparent; font-size: 14px; background: #fff; box-shadow: var(--shadow-sm); transition: all 0.2s; }
        .search-box input:focus { border-color: var(--brand-red); box-shadow: 0 0 0 4px rgba(225, 79, 75, 0.1); }
        .search-icon { position: absolute; left: 16px; top: 14px; opacity: 0.4; }

        .section { display: none; animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; }
        @media (max-width: 1200px) { .grid-4 { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .grid-4 { grid-template-columns: 1fr; } }

        .tabs-container { display: flex; gap: 10px; margin-bottom: 20px; }
        .tab-btn { padding: 8px 20px; border-radius: 20px; border: 1px solid #e2e8f0; background: #fff; color: #64748b; cursor: pointer; font-size: 14px; font-weight: 600; transition: all 0.2s ease; }
        .tab-btn:hover { background: #f8fafc; color: var(--brand-red); border-color: rgba(225, 79, 75, 0.3); }
        .tab-btn.active { background: var(--brand-red); color: #fff; border-color: var(--brand-red); box-shadow: 0 4px 10px rgba(225, 79, 75, 0.2); }

        .card { background: var(--card-bg); padding: 24px; border-radius: var(--radius); box-shadow: var(--shadow-sm); transition: all 0.3s ease; border: 1px solid rgba(0,0,0,0.05); position: relative; overflow: hidden; display: flex; flex-direction: column; height: 100%; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 12px 24px rgba(9, 22, 50, 0.15); border-color: rgba(9, 22, 50, 0.1); }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 3px; background: var(--brand-red); opacity: 0; transition: opacity 0.3s; }
        .card:hover::before { opacity: 1; }
        
        .card-icon { width: 48px; height: 48px; background: rgba(225, 79, 75, 0.1); color: var(--brand-red); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 22px; margin-bottom: 16px; }
        .card h3 { font-size: 18px; font-weight: 700; margin-bottom: 10px; color: #000; }
        .card p { font-size: 14px; color: var(--text-secondary); line-height: 1.6; margin-bottom: 20px; flex-grow: 1; }
        
        /* 按鈕樣式 */
        .btn, .btn-outline { 
            display: flex; align-items: center; justify-content: center; 
            padding: 0 10px; height: 42px; 
            border-radius: 8px; text-decoration: none; 
            font-size: 13px; font-weight: 600; transition: all 0.2s; 
            cursor: pointer; width: 100%; margin-top: auto; 
            box-sizing: border-box; white-space: nowrap; 
        }
        .btn { background-color: var(--brand-red); color: #fff; border: none; }
        .btn:hover { background-color: #c93d39; box-shadow: 0 4px 12px rgba(225, 79, 75, 0.3); }
        .btn-outline { background: transparent; border: 2px solid #e2e8f0; color: #475569; }
        .btn-outline:hover { border-color: var(--brand-red); color: var(--brand-red); background: rgba(225, 79, 75, 0.05); }

        .btn-group { display: flex; gap: 10px; margin-top: auto; width: 100%; }
        .btn-group .btn, .btn-group .btn-outline { margin-top: 0; flex: 1 1 0; width: 0; } 

        .tag { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; display: inline-block; margin-bottom: 12px; letter-spacing: 0.5px; }
        .tag-primary { background: rgba(225, 79, 75, 0.15); color: var(--brand-red); }
        .tag-secondary { background: #f0f0f0; color: #666; }
        .tag-high-risk { background: #fee2e2; color: #ef4444; }

        .alert { padding: 20px; border-radius: 12px; margin-bottom: 24px; font-size: 15px; line-height: 1.6; border-left: 5px solid var(--brand-red); background: #fff; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 15px; overflow: hidden; }
        .alert-icon { color: var(--brand-red); font-size: 20px; flex-shrink: 0; }
        .notice-container { flex: 1; position: relative; height: 24px; overflow: hidden; }
        .notice-text { position: absolute; top: 0; left: 0; width: 100%; transition: transform 0.5s ease, opacity 0.5s ease; display: flex; align-items: center; }
        .notice-active { transform: translateY(0); opacity: 1; }
        .notice-hidden { transform: translateY(30px); opacity: 0; }
        .notice-date { font-weight: 800; color: var(--brand-red); margin-right: 10px; font-family: monospace; letter-spacing: 1px; }

        .table-container { overflow-x: auto; border-radius: 12px; box-shadow: var(--shadow-sm); }
        .tech-table { width: 100%; border-collapse: collapse; background: #fff; }
        .tech-table th { background: #091632; text-align: left; padding: 16px; font-size: 13px; color: #fff; text-transform: uppercase; letter-spacing: 1px; }
        .tech-table td { padding: 16px; border-bottom: 1px solid #eee; font-size: 15px; color: #333; }
        .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; background: var(--brand-red); box-shadow: 0 0 8px var(--brand-red); }

        .modal { display: none; position: fixed; z-index: 100; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); backdrop-filter: blur(2px); align-items: center; justify-content: center; }
        .modal-content { background-color: #fff; border-radius: 16px; width: 90%; max-width: 640px; height: 85%; box-shadow: 0 20px 40px rgba(0,0,0,0.2); position: relative; overflow: hidden; animation: modalPop 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes modalPop { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .close-modal { position: absolute; right: 20px; top: 15px; font-size: 28px; cursor: pointer; color: #666; z-index: 10; background: rgba(255,255,255,0.8); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .close-modal:hover { color: #000; background: #fff; }
        iframe.gform-frame { width: 100%; height: 100%; border: none; }

        /* --- Blog 日誌樣式 --- */
        .blog-container { max-width: 800px; margin: 0 auto; }
        .blog-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .blog-timeline { position: relative; padding-left: 20px; border-left: 2px solid #e2e8f0; }
        .blog-post { position: relative; background: #fff; border-radius: 12px; padding: 24px; margin-bottom: 30px; box-shadow: var(--shadow-sm); border: 1px solid rgba(0,0,0,0.05); }
        .blog-post::before { content: ''; position: absolute; left: -27px; top: 24px; width: 12px; height: 12px; background: var(--brand-red); border-radius: 50%; border: 3px solid #fff; box-shadow: 0 0 0 3px #e2e8f0; }
        .post-meta { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .post-date { font-weight: 700; color: #64748b; font-size: 14px; }
        .post-version { background: #f1f5f9; padding: 4px 10px; border-radius: 20px; font-size: 12px; color: #475569; font-weight: 600; }
        .post-content h4 { font-size: 20px; margin-bottom: 12px; color: #1e293b; }
        .post-content p { color: #475569; line-height: 1.7; margin-bottom: 15px; }
        .post-content ul { padding-left: 20px; color: #475569; margin-bottom: 15px; }
        .post-content li { margin-bottom: 8px; }
        .post-tags { display: flex; gap: 8px; }
        .tag-small { font-size: 11px; padding: 3px 8px; background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 4px; color: #64748b; }
    </style>
</head>
<body>

    <div id="bugModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeModal()">&times;</span>
            <iframe class="gform-frame" src="https://docs.google.com/forms/d/e/1FAIpQLSdbQCLdb9L3c7CBt5zFZOD3pIX4H869HkqWi9TSQXu56537YA/viewform?embedded=true">Loading...</iframe>
        </div>
    </div>

    <nav class="sidebar">
        <div class="brand"><span>●</span> TAIWAN<br>AnyTag/AnyCreator<br>Support Hub</div>
        <div class="nav-group">
            <div class="nav-title">MAIN MENU</div>
            <div class="nav-item active" onclick="showPage('dashboard', this)"><i class="fa-solid fa-chart-line"></i> 儀表板 (Dashboard)</div>
            <div class="nav-item" onclick="showPage('anytag', this)"><i class="fa-solid fa-bullseye"></i> AnyTag 平台指南</div>
            <div class="nav-item" onclick="showPage('anycreator', this)"><i class="fa-solid fa-wand-magic-sparkles"></i> AnyCreator 創作者</div>
        </div>
        <div class="nav-group">
            <div class="nav-title">SUPPORT & SALES</div>
            <div class="nav-item" onclick="showPage('troubleshoot', this)"><i class="fa-solid fa-screwdriver-wrench"></i> 疑難排解 (Trouble)</div>
            <div class="nav-item" onclick="showPage('resources', this)"><i class="fa-solid fa-folder-open"></i> 資源中心 (Resources)</div>
        </div>
        
        <div style="margin-top: auto; font-size: 11px; color: #6d7f96; padding-left: 12px; line-height: 1.5;">
            AnyMind Group © 2025<br>Internal Use Only<br>
            <span style="color: var(--brand-red);">v.0.0.1 (Beta)</span>
        </div>
    </nav>

    <main class="main">
        <div class="top-bar">
            <div class="page-title">
                <h1 id="header-title">Dashboard</h1>
                <p id="header-desc">Welcome！遇到AnyTag/AnyCreator的疑難雜症了嗎？我來幫你解決！</p>
            </div>
            <div class="search-box">
                <span class="search-icon"><i class="fa-solid fa-magnifying-glass"></i></span>
                <input type="text" id="searchInput" placeholder="搜尋 SOP、FAQ 或資源..." onkeyup="smartSearch()">
            </div>
        </div>

        <div id="dashboard" class="section active">
            <div class="alert">
                <i class="fa-solid fa-bell alert-icon"></i>
                <div class="notice-container" id="notice-box"></div>
            </div>

            <h3 style="margin-bottom: 20px; font-weight: 700;">捷徑 (Quick Access)</h3>
            
            <div class="tabs-container">
                <button class="tab-btn active" onclick="filterRole('All')">全部</button>
                <button class="tab-btn" onclick="filterRole('BD')">業務專區 (BD)</button>
                <button class="tab-btn" onclick="filterRole('IM')">執行專區 (IM)</button>
            </div>

            <div id="quick-access-container" class="grid-4"></div>

            <h3 style="margin-bottom: 20px; font-weight: 700;">平台狀態概覽</h3>
            <div class="table-container">
                <table class="tech-table">
                    <thead><tr><th>平台名稱</th><th>使用對象</th><th>核心功能</th><th>狀態</th></tr></thead>
                    <tbody>
                        <tr><td><strong>AnyTag</strong></td><td>品牌客戶 / 內部人員</td><td>網紅搜尋、數據分析、專案管理</td><td><span class="status-dot"></span>運作中</td></tr>
                        <tr><td><strong>AnyCreator</strong></td><td>網紅 / 創作者</td><td>接案媒合、連結管理、帳號分析</td><td><span class="status-dot"></span>運作中</td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 產品更新日誌頁面 -->
        <div id="updates" class="section">
            <div class="blog-container">
                <div class="blog-header">
                    <button class="btn-outline" style="width: auto;" onclick="showPage('dashboard')"><i class="fa-solid fa-arrow-left"></i> 返回儀表板</button>
                    <!-- 預留：未來這裡可以放圖表按鈕 -->
                </div>
                <!-- 預留：Dashboard 圖表區塊 -->
                <div style="background:#fff; padding:20px; border-radius:12px; margin-bottom:30px; display:none;">
                    <h4 style="margin-bottom:10px;">更新趨勢 (Demo)</h4>
                    <div style="height:150px; background:#f4f4f9; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#999;">Chart Area (Phase 3)</div>
                </div>

                <div class="blog-timeline" id="blog-container">
                    <!-- 日誌內容將由 JS 自動生成 -->
                </div>
            </div>
        </div>

        <div id="anytag" class="section"><div class="card"><h3>AnyTag 指南建置中...</h3></div></div>
        <div id="anycreator" class="section"><div class="card"><h3>AnyCreator 指南建置中...</h3></div></div>
        <div id="troubleshoot" class="section"><div class="card"><h3>疑難排解建置中...</h3></div></div>
        <div id="resources" class="section"><div class="card"><h3>資源中心建置中...</h3></div></div>

    </main>

    <script>
        // ============================================
        //  Phase 2: Google Sheet 日誌系統 (自動追蹤)
        // ============================================
        const LOGGER_URL = "https://script.google.com/macros/s/AKfycbxdLO-ubptCO9gE_1yRj5TT-nY6Yujl9Dr-oSlyhQHUyBxUxTJpDLruk-H32fuPlOLb/exec";

        function sendToSheet(action, label, note) {
            if(!LOGGER_URL.startsWith("http")) return;
            fetch(LOGGER_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ action: action, label: label, note: note })
            }).then(() => {
                console.log("Log sent to Sheet:", action, label);
            }).catch(err => console.error("Log failed:", err));
        }

        // ============================================
        //  產品更新日誌資料庫 (Blog Posts)
        //  在這裡新增每月的更新內容，支援 HTML 標籤
        // ============================================
        const blogPosts = [
            {
                date: "2025-11-20",
                version: "v2.5.0",
                title: "AnyCreator 創作者頁面大改版",
                content: `
                    <p>本次更新重點在於優化創作者的案件管理體驗，新增了案件狀態追蹤功能，創作者現在可以清楚看到每個階段的審核進度。</p>
                    <ul>
                        <li><strong>新增：</strong>案件狀態進度條 (Pending -> Approved -> Completed)</li>
                        <li><strong>優化：</strong>手機版介面載入速度提升 30%</li>
                        <li><strong>修復：</strong>部分 Android 裝置無法上傳 Insight 截圖的問題</li>
                    </ul>
                `,
                tags: ["AnyCreator", "Feature", "Mobile"]
            },
            {
                date: "2025-11-05",
                version: "v2.4.8",
                title: "Threads 平台擴充支援",
                content: `
                    <p>因應 Threads 用戶快速增長，AnyTag 現在正式支援 Threads 貼文數據抓取。目前僅限公開帳號。</p>
                    <ul>
                        <li>支援抓取最近 100 篇貼文數據 (Likes, Replies)</li>
                        <li>可將 Threads 貼文加入報表 (Report)</li>
                    </ul>
                `,
                tags: ["AnyTag", "New Platform"]
            }
        ];

        // ============================================
        //  知識庫資料 (Knowledge Base)
        // ============================================
        const knowledgeBase = [
            {
                id: "001",
                title: "網紅搜尋 SOP",
                desc: "如何使用 AI Search 與 圖片搜尋找到精準網紅？",
                tag: "User Guide",
                tagClass: "tag-primary",
                icon: "fa-solid fa-magnifying-glass-location",
                btnText: "前往教學",
                btnLink: "#", 
                btnStyle: "btn",
                riskLevel: "low",
                category: "AnyTag",
                roles: ['IM'] 
            },
            {
                id: "002",
                title: "數據沒更新？",
                desc: "遇到平台profile page數據跑不出來？先來這裡看解決步驟。",
                tag: "FAQ",
                tagClass: "tag-secondary",
                icon: "fa-regular fa-circle-question",
                btnText: "查看解決方案",
                btnLink: "#",
                btnStyle: "btn-outline",
                riskLevel: "low",
                category: "AnyTag",
                roles: ['BD', 'IM']
            },
            {
                id: "003",
                title: "許願池 / 問題回報",
                desc: "系統異常或有新需求？不需要填單，直接留言讓我們知道。",
                tag: "Wishlist",
                tagClass: "tag-primary",
                icon: "fa-solid fa-comments",
                keywords: "bug, 需求, 建議, issue, error, 錯誤",
                customHtml: `
                    <div class="btn-group">
                        <button class="btn" onclick="openModal()">我要留言</button>
                        <a href="https://docs.google.com/spreadsheets/d/1p76lv6-WMDtE6kccM3X9eBJEuyUNBz6IG6q9hp7Jj5I/edit?gid=954115785#gid=954115785" target="_blank" class="btn-outline">查看留言板</a>
                    </div>
                `,
                riskLevel: "low",
                category: "System",
                roles: ['BD', 'IM']
            },
            {
                id: "004",
                title: "產品動態更新",
                desc: "AnyTag / AnyCreator 最新功能發布與優化日誌。",
                tag: "Updates",
                tagClass: "tag-secondary",
                icon: "fa-solid fa-rocket",
                // 修改：使用自定義按鈕呼叫內部頁面
                customHtml: `<button class="btn-outline" onclick="showPage('updates'); logDecision('004', '產品動態更新')">查看月報</button>`,
                riskLevel: "low",
                category: "System",
                roles: ['BD', 'IM']
            },
            {
                id: "005",
                title: "Marketplace 銷售門檻",
                desc: "網紅媒合功能(Marketplace)在台灣落地的門檻限制說明。",
                tag: "Sales Kit",
                tagClass: "tag-primary",
                icon: "fa-solid fa-shop",
                btnText: "查看規範表",
                btnLink: "https://docs.google.com/spreadsheets/d/1gHKGwOajXzjoXorGBgo9chxLAl0lH4SngOfdgsTDvP4/edit?gid=0#gid=0",
                btnStyle: "btn",
                riskLevel: "low",
                category: "Sales",
                roles: ['BD'] 
            },
            {
                id: "006",
                title: "結案報告範本",
                desc: "標準結案報告 PPT 模板與數據填寫說明。",
                tag: "Template",
                tagClass: "tag-secondary",
                icon: "fa-solid fa-file-powerpoint",
                btnText: "下載 PPT",
                btnLink: "#",
                btnStyle: "btn-outline",
                riskLevel: "low",
                category: "IM",
                roles: ['IM']
            },
            {
                id: "999",
                title: "帳號封禁申訴",
                desc: "遇到創作者帳號被封鎖或金流問題？此為高風險項目。",
                tag: "High Risk",
                tagClass: "tag-high-risk",
                icon: "fa-solid fa-ban",
                btnText: "聯繫法務",
                btnLink: "mailto:legal@anymindgroup.com",
                btnStyle: "btn-outline",
                riskLevel: "high", 
                category: "AnyCreator",
                roles: ['BD', 'IM'],
                hidden: true 
            }
        ];

        const notices = [
            "<span class='notice-date'>2025.11月</span> Threads擴充更新！可抓取100篇貼文協助提案分析。",
            "<span class='notice-date'>2025.11月</span> AnyTag更新：Engagement report automation。",
            "<span class='notice-date'>2025.11月</span> AnyCreator創作者頁面更新，新增各案件狀態。"
        ];

        let currentRole = 'All';
        let searchDebounce = null; 

        function filterRole(role) {
            currentRole = role;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.innerText.includes(role === 'All' ? '全部' : role)) {
                    btn.classList.add('active');
                }
            });
            renderCards();
            sendToSheet("Switch_Tab", role, "User switched view");
        }

        function renderCards() {
            const container = document.getElementById('quick-access-container');
            container.innerHTML = ''; 

            knowledgeBase.forEach(item => {
                if (item.hidden) return; 

                if (currentRole === 'All' || item.roles.includes(currentRole)) {
                    let actionHtml = '';
                    if (item.customHtml) {
                        actionHtml = item.customHtml;
                    } else {
                        actionHtml = `<a href="${item.btnLink}" target="_blank" class="${item.btnStyle}" onclick="logDecision('${item.id}', '${item.title}')">${item.btnText}</a>`;
                    }

                    const cardHTML = `
                        <div class="card">
                            <div class="card-icon"><i class="${item.icon}"></i></div>
                            <span class="tag ${item.tagClass}">${item.tag}</span>
                            <h3>${item.title}</h3>
                            <p>${item.desc}</p>
                            ${actionHtml}
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                }
            });
        }

        function renderBlog() {
            const container = document.getElementById('blog-container');
            container.innerHTML = '';
            
            blogPosts.forEach(post => {
                const tagsHtml = post.tags.map(t => `<span class="tag-small">#${t}</span>`).join('');
                const html = `
                    <div class="blog-post">
                        <div class="post-meta">
                            <div class="post-date">${post.date}</div>
                            <span class="post-version">${post.version}</span>
                        </div>
                        <div class="post-content">
                            <h4>${post.title}</h4>
                            ${post.content}
                        </div>
                        <div class="post-tags">${tagsHtml}</div>
                    </div>
                `;
                container.innerHTML += html;
            });
        }

        function openModal() {
            document.getElementById('bugModal').style.display = "flex";
        }

        function closeModal() {
            document.getElementById('bugModal').style.display = "none";
        }

        window.onclick = function(event) {
            const modal = document.getElementById('bugModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        function logDecision(id, title) {
            const timestamp = new Date().toISOString();
            console.log(`[Log] Time: ${timestamp} | User Clicked: ${title} (ID: ${id})`);
            sendToSheet("Click", title, `ID: ${id}`);
        }

        function smartSearch() {
            if (searchDebounce) clearTimeout(searchDebounce);

            let input = document.getElementById('searchInput').value.toLowerCase();
            const container = document.getElementById('quick-access-container');
            container.innerHTML = ''; 

            let hasResult = false;

            knowledgeBase.forEach(item => {
                if (item.title.toLowerCase().includes(input) || 
                    item.desc.toLowerCase().includes(input) || 
                    item.tag.toLowerCase().includes(input) ||
                    (item.keywords && item.keywords.toLowerCase().includes(input))) {
                    
                    hasResult = true;
                    
                    let alertHtml = '';
                    if (item.riskLevel === 'high') {
                        console.warn(`[Risk Alert] User searched for high risk item: ${item.title}`);
                        alertHtml = `<div style="color:red; font-size:12px; margin-bottom:5px;"><i class="fa-solid fa-triangle-exclamation"></i> 注意：此為高風險操作</div>`;
                        sendToSheet("Risk_Alert", input, `Triggered by: ${item.title}`);
                    }

                    let actionHtml = '';
                    if (item.customHtml) {
                        actionHtml = item.customHtml;
                    } else {
                        actionHtml = `<a href="${item.btnLink}" target="_blank" class="${item.btnStyle}" onclick="logDecision('${item.id}', '${item.title}')">${item.btnText}</a>`;
                    }

                    const cardHTML = `
                        <div class="card" style="border: ${item.riskLevel === 'high' ? '1px solid red' : ''}">
                            <div class="card-icon"><i class="${item.icon}"></i></div>
                            <span class="tag ${item.tagClass}">${item.tag}</span>
                            ${alertHtml}
                            <h3>${item.title}</h3>
                            <p>${item.desc}</p>
                            ${actionHtml}
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                }
            });

            if (!hasResult) {
                container.innerHTML = `<div style="grid-column: 1/-1; text-align:center; color:#888; padding:20px;">找不到相關結果，請嘗試搜尋「SOP」或「數據」。</div>`;
                if(input.length > 1) {
                    searchDebounce = setTimeout(() => {
                        sendToSheet("Search_Failed", input, "No Result Found");
                    }, 2000);
                }
            }
        }

        window.onload = function() {
            renderCards(); 
            renderBlog(); // 初始化日誌
            startNoticeCarousel();
        };

        function showPage(pageId, navElement) {
            document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            if(navElement) navElement.classList.add('active');
            
            const map = {
                'dashboard': ['Dashboard', 'Welcome！遇到AnyTag/AnyCreator的疑難雜症了嗎？我來幫你解決！'],
                'updates': ['Changelog', 'AnyTag / AnyCreator 產品更新日誌'], // 新增日誌標題
                'anytag': ['AnyTag Guide', '平台核心功能說明'],
                'anycreator': ['AnyCreator', '創作者端功能'],
                'troubleshoot': ['Troubleshooting', '常見問題排解'],
                'resources': ['Resources', '資源中心']
            };
            if(map[pageId]) {
                document.getElementById('header-title').innerText = map[pageId][0];
                document.getElementById('header-desc').innerText = map[pageId][1];
            }
        }

        function startNoticeCarousel() {
            let noticeIndex = 0;
            const noticeBox = document.getElementById('notice-box');
            function rotate() {
                const current = noticeBox.querySelector('.notice-text');
                if(current) {
                    current.classList.remove('notice-active');
                    current.classList.add('notice-hidden');
                }
                setTimeout(() => {
                    noticeIndex = (noticeIndex + 1) % notices.length;
                    noticeBox.innerHTML = `<div class="notice-text notice-hidden">${notices[noticeIndex]}</div>`;
                    setTimeout(() => {
                        const newText = noticeBox.querySelector('.notice-text');
                        newText.classList.remove('notice-hidden');
                        newText.classList.add('notice-active');
                    }, 50);
                }, 500);
            }
            noticeBox.innerHTML = `<div class="notice-text notice-active">${notices[0]}</div>`;
            setInterval(rotate, 4000);
        }
    </script>
</body>
</html>
